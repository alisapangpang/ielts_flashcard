<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸¬è©¦åŒ¯å‡º/åŒ¯å…¥åŠŸèƒ½</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <div style="background: #2a2a2a; padding: 40px; border-radius: 20px; margin-top: 50px;">
      <h1 style="color: white; text-align: center; margin-bottom: 30px;">åŒ¯å‡º/åŒ¯å…¥åŠŸèƒ½æ¸¬è©¦</h1>
      
      <div id="testLog" style="background: #1a1a1a; padding: 20px; border-radius: 12px; margin-bottom: 30px; color: #10b981; font-family: monospace; font-size: 14px; min-height: 100px;">
        ç­‰å¾…æ¸¬è©¦...
      </div>
      
      <div class="data-management">
        <button id="exportBtn" class="export-btn">ğŸ“¥ åŒ¯å‡ºé€²åº¦</button>
        <button id="importBtn" class="import-btn">ğŸ“¤ åŒ¯å…¥é€²åº¦</button>
        <input type="file" id="importFile" accept=".json" style="display: none;">
      </div>
      
      <div style="color: #808080; text-align: center; margin-top: 20px; font-size: 14px;">
        <p>âœ… å¦‚æœæŒ‰éˆ•æœ‰åæ‡‰ï¼Œæœƒåœ¨ä¸Šæ–¹é¡¯ç¤ºè¨Šæ¯</p>
        <p>âŒ å¦‚æœæŒ‰éˆ•æ²’åæ‡‰ï¼Œå¯èƒ½æ˜¯ JS è¼‰å…¥å¤±æ•—</p>
      </div>
    </div>
  </div>

  <script src="words.js"></script>
  <script src="storage.js"></script>
  
  <script>
    const log = document.getElementById('testLog');
    
    function addLog(message, isError = false) {
      const time = new Date().toLocaleTimeString();
      const color = isError ? '#ef4444' : '#10b981';
      log.innerHTML += `<div style="color: ${color};">[${time}] ${message}</div>`;
      log.scrollTop = log.scrollHeight;
    }
    
    // æª¢æŸ¥ä¾è³´
    if (typeof WORDS === 'undefined') {
      addLog('âŒ WORDS æœªè¼‰å…¥', true);
    } else {
      addLog(`âœ… WORDS è¼‰å…¥æˆåŠŸ (${WORDS.length} å€‹å–®å­—)`);
    }
    
    if (typeof Storage === 'undefined') {
      addLog('âŒ Storage æœªè¼‰å…¥', true);
    } else {
      addLog('âœ… Storage è¼‰å…¥æˆåŠŸ');
    }
    
    // æ¸¬è©¦åŒ¯å‡ºåŠŸèƒ½
    document.getElementById('exportBtn').addEventListener('click', function() {
      addLog('ğŸ“¥ åŒ¯å‡ºæŒ‰éˆ•è¢«é»æ“Šäº†ï¼');
      
      try {
        const progress = Storage.getProgress();
        const dailyProgress = Storage.getDailyProgressRaw ? Storage.getDailyProgressRaw() : {};
        
        const data = {
          version: '1.0',
          exportDate: new Date().toISOString(),
          wordProgress: progress,
          dailyProgress: dailyProgress,
          totalWords: WORDS.length,
          statistics: Storage.getStatistics()
        };
        
        addLog(`âœ… è³‡æ–™æº–å‚™å®Œæˆ: ${Object.keys(progress).length} å€‹å–®å­—é€²åº¦`);
        
        const dataStr = JSON.stringify(data, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `flashcard-test-${Date.now()}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        addLog('âœ… æª”æ¡ˆä¸‹è¼‰æˆåŠŸï¼');
        
      } catch (error) {
        addLog('âŒ åŒ¯å‡ºå¤±æ•—: ' + error.message, true);
        console.error(error);
      }
    });
    
    // æ¸¬è©¦åŒ¯å…¥åŠŸèƒ½
    document.getElementById('importBtn').addEventListener('click', function() {
      addLog('ğŸ“¤ åŒ¯å…¥æŒ‰éˆ•è¢«é»æ“Šäº†ï¼');
      document.getElementById('importFile').click();
    });
    
    document.getElementById('importFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) {
        addLog('âš ï¸ æ²’æœ‰é¸æ“‡æª”æ¡ˆ');
        return;
      }
      
      addLog(`ğŸ“ é¸æ“‡äº†æª”æ¡ˆ: ${file.name}`);
      
      const reader = new FileReader();
      
      reader.onload = function(event) {
        try {
          const data = JSON.parse(event.target.result);
          addLog('âœ… æª”æ¡ˆè§£ææˆåŠŸ');
          addLog(`ğŸ“Š æª”æ¡ˆåŒ…å« ${Object.keys(data.wordProgress || {}).length} å€‹å–®å­—é€²åº¦`);
          
          // å¯¦éš›åŒ¯å…¥
          localStorage.setItem('flashcard_progress', JSON.stringify(data.wordProgress));
          if (data.dailyProgress) {
            localStorage.setItem('flashcard_daily_progress', JSON.stringify(data.dailyProgress));
          }
          
          addLog('âœ… é€²åº¦åŒ¯å…¥æˆåŠŸï¼');
          
        } catch (error) {
          addLog('âŒ æª”æ¡ˆè§£æå¤±æ•—: ' + error.message, true);
          console.error(error);
        }
      };
      
      reader.onerror = function() {
        addLog('âŒ è®€å–æª”æ¡ˆå¤±æ•—', true);
      };
      
      reader.readAsText(file);
    });
    
    addLog('âœ… æ¸¬è©¦é é¢åˆå§‹åŒ–å®Œæˆ');
  </script>
</body>
</html>